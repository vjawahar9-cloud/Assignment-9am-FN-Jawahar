<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Api Task 6 to 10</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { padding: 20px; }
    .theme-dark { background: #1a1a1a; color: #fff; }
    .theme-dark .card { background: #2d2d2d; }
    .theme-dark .list-group-item { background: #363636; }
    .cart-item { display: flex; justify-content: space-between; align-items: center; }
    .loading { opacity: 0.6; }
  </style>
</head>
<body>
  <div class="container">
    <!-- 3.   Theme Switcher + Login Status -->
    <div class="d-flex justify-content-between align-items-center mb-4">
      <div>
        <span class="badge bg-secondary me-2">Status: <span id="login-status">Guest</span></span>
        <button id="login-btn" class="btn btn-sm btn-success">Login</button>
        <button id="logout-btn" class="btn btn-sm btn-danger" style="display:none;">Logout</button>
      </div>
      <button id="theme-toggle" class="btn btn-outline-secondary btn-sm">
         Dark Mode
      </button>
    </div>

    <!--   1. Users List -->
    <div class="row">
      <div class="col-md-8">
        <div class="card">
          <div class="card-header d-flex justify-content-between">
            <h5>User List (<span id="user-count">0</span>)</h5>
            <button id="fetch-users" class="btn btn-primary btn-sm"> Fetch Users</button>
          </div>
          <ul id="user-list" class="list-group list-group-flush"></ul>
          <div id="api-error" class="alert alert-danger mt-2" style="display:none;"></div>
        </div>
      </div>

      <!-- 5.   Shopping Cart -->
      <div class="col-md-4">
        <div class="card sticky-top" style="top:20px;">
          <div class="card-header">
            <h6>ðŸ›’ Shopping Cart (<span id="cart-count">0</span>)</h6>
          </div>
          <div class="card-body">
            <div id="cart-items"></div>
            <div id="cart-total" class="fw-bold mt-2"></div>
            <button id="clear-cart" class="btn btn-sm btn-warning w-100 mt-2">Clear Cart</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    //  1. FETCH & DISPLAY USER LIST
    async function fetchUsers() {
      const fetchBtn = document.getElementById('fetch-users');
      const userList = document.getElementById('user-list');
      const userCount = document.getElementById('user-count');
      const apiError = document.getElementById('api-error');
      
      fetchBtn.disabled = true;
      fetchBtn.innerHTML = 'â³ Loading...';
      fetchBtn.classList.add('loading');
      apiError.style.display = 'none';
      
      try {
        const response = await fetch('https://jsonplaceholder.typicode.com/users?_limit=6');
        
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        
        const users = await response.json();
        userCount.textContent = users.length;
        
       
        userList.innerHTML = users.map(user => `
          <li class="list-group-item d-flex justify-content-between align-items-center">
            <div>
              <h6>${user.name}</h6>
              <small class="text-muted">${user.email}</small>
            </div>
            <button class="btn btn-sm btn-outline-primary add-to-cart" 
                    data-id="${user.id}" data-name="${user.name}" data-price="99">
              Add to Cart â‚¹99
            </button>
          </li>
        `).join('');
        
      } catch (error) {
        //  4. API ERROR HANDLING 
        console.error('API Error:', error);
        apiError.style.display = 'block';
        apiError.innerHTML = `
           <strong>Failed to fetch users:</strong><br>
          ${error.message}<br>
          <small>Check network or try again</small>
        `;
      } finally {
        fetchBtn.disabled = false;
        fetchBtn.innerHTML = ' Fetch Users';
        fetchBtn.classList.remove('loading');
      }
    }

    //2. LOGIN STATUS in localStorage 
    function updateLoginStatus(isLoggedIn) {
      const statusEl = document.getElementById('login-status');
      const loginBtn = document.getElementById('login-btn');
      const logoutBtn = document.getElementById('logout-btn');
      
      if (isLoggedIn) {
        statusEl.textContent = 'Logged In';
        statusEl.className = 'badge bg-success';
        loginBtn.style.display = 'none';
        logoutBtn.style.display = 'inline-block';
        
        
        localStorage.setItem('isLoggedIn', JSON.stringify(true));
        localStorage.setItem('loginTime', new Date().toISOString());
      } else {
        statusEl.textContent = 'Guest';
        statusEl.className = 'badge bg-secondary';
        loginBtn.style.display = 'inline-block';
        logoutBtn.style.display = 'none';
        
       
        localStorage.removeItem('isLoggedIn');
        localStorage.removeItem('loginTime');
      }
    }

    //  3. THEME SWITCHER using storage 
    function initTheme() {
      const savedTheme = localStorage.getItem('theme') || 'light';
      document.body.className = savedTheme === 'dark' ? 'theme-dark' : '';
      document.getElementById('theme-toggle').textContent = 
        savedTheme === 'dark' ? ' Light Mode' : ' Dark Mode';
    }

    function toggleTheme() {
      const isDark = document.body.classList.contains('theme-dark');
      const newTheme = isDark ? 'light' : 'dark';
      
      document.body.className = newTheme === 'dark' ? 'theme-dark' : '';
      document.getElementById('theme-toggle').textContent = 
        newTheme === 'dark' ? ' Light Mode' : ' Dark Mode';
      
      
      localStorage.setItem('theme', newTheme);
    }

    // 5. CART with JSON + localStorage 
    let cart = JSON.parse(localStorage.getItem('cart')) || [];

    function updateCart() {
      const cartCount = document.getElementById('cart-count');
      const cartItems = document.getElementById('cart-items');
      const cartTotal = document.getElementById('cart-total');
      
      cartCount.textContent = cart.length;
      
      if (cart.length === 0) {
        cartItems.innerHTML = '<small class="text-muted">Cart is empty</small>';
        cartTotal.textContent = '';
        return;
      }
      
      const total = cart.reduce((sum, item) => sum + item.price, 0);
      cartItems.innerHTML = cart.map(item => `
        <div class="cart-item p-2 border-bottom">
          <span>${item.name}</span>
          <span>â‚¹${item.price.toLocaleString()}</span>
        </div>
      `).join('');
      
      cartTotal.innerHTML = `<strong>Total: â‚¹${total.toLocaleString()}</strong>`;
      
   
      localStorage.setItem('cart', JSON.stringify(cart));
    }

    function addToCart(id, name, price) {
      cart = [...cart, { id, name, price }];
      updateCart();
    }

    function clearCart() {
      cart = [];
      updateCart();
    }

    document.getElementById('fetch-users').addEventListener('click', fetchUsers);
    
    document.getElementById('login-btn').addEventListener('click', () => updateLoginStatus(true));
    document.getElementById('logout-btn').addEventListener('click', () => updateLoginStatus(false));
    
    document.getElementById('theme-toggle').addEventListener('click', toggleTheme);
    document.getElementById('clear-cart').addEventListener('click', clearCart);

    document.getElementById('user-list').addEventListener('click', (e) => {
      if (e.target.classList.contains('add-to-cart')) {
        const id = e.target.dataset.id;
        const name = e.target.dataset.name;
        const price = parseInt(e.target.dataset.price);
        addToCart(id, name, price);
      }
    });

    // INIT 
    initTheme();
    
   
    const savedLogin = localStorage.getItem('isLoggedIn');
    if (savedLogin === 'true') {
      updateLoginStatus(true);
    }
    
    updateCart(); 
  </script>
</body>
</html>