<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Section B</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
        max-width: 800px;
        margin: 0 auto;
      }
      .exercise {
        margin-bottom: 25px;
        padding: 20px;
        border-left: 4px solid #007bff;
        background: #f8f9fa;
      }
      button {
        padding: 8px 16px;
        margin: 4px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }
      .btn-primary {
        background: #007bff;
        color: white;
      }
      .output {
        margin-top: 10px;
        padding: 10px;
        background: white;
        border-radius: 4px;
        font-family: monospace;
      }
      .success {
        color: #28a745;
      }
      .error {
        color: #dc3545;
      }
    </style>
  </head>
  <body>
    <h1>Async JavaScript Exercises</h1>

    <!-- 1. Callback with setTimeout -->
    <div class="exercise">
      <h3>1. Callback + setTimeout (3 seconds)</h3>
      <button class="btn-primary" onclick="exercise1()">Run Callback</button>
      <div id="ex1-output" class="output"></div>
    </div>

    <!-- 2. Callback to Promise -->
    <div class="exercise">
      <h3>2. Callback ‚Üí Promise Conversion</h3>
      <button class="btn-primary" onclick="exercise2()">Test Promise</button>
      <div id="ex2-output" class="output"></div>
    </div>

    <!-- 3. Promise resolves after 2s -->
    <div class="exercise">
      <h3>3. Promise Resolves (2 seconds)</h3>
      <button class="btn-primary" onclick="exercise3()">Create Promise</button>
      <div id="ex3-output" class="output"></div>
    </div>

    <!-- 4. Rejected Promise with .catch() -->
    <div class="exercise">
      <h3>4. Rejected Promise + .catch()</h3>
      <button class="btn-primary" onclick="exercise4()">Test Rejection</button>
      <div id="ex4-output" class="output"></div>
    </div>

    <!-- 5. Promise ‚Üí async/await -->
    <div class="exercise">
      <h3>5. Promise ‚Üí async/await Rewrite</h3>
      <button class="btn-primary" onclick="exercise5()">
        Async/Await Version
      </button>
      <div id="ex5-output" class="output"></div>
    </div>

    <!-- 6. try/catch with async/await -->
    <div class="exercise">
      <h3>6. try/catch + async/await</h3>
      <button class="btn-primary" onclick="exercise6()">
        Test Error Handling
      </button>
      <div id="ex6-output" class="output"></div>
    </div>

    <!-- 7. Random success/failure -->
    <div class="exercise">
      <h3>7. Random Promise (50% fail)</h3>
      <button class="btn-primary" onclick="exercise7()">Random API Call</button>
      <div id="ex7-output" class="output"></div>
    </div>

    <!-- 8. Promise chaining -->
    <div class="exercise">
      <h3>8. Promise Chaining (.then() x2)</h3>
      <button class="btn-primary" onclick="exercise8()">Chain Promises</button>
      <div id="ex8-output" class="output"></div>
    </div>

    <!-- 9. Promise.all() -->
    <div class="exercise">
      <h3>9. Wait for 2 Promises (Promise.all)</h3>
      <button class="btn-primary" onclick="exercise9()">Fetch Both</button>
      <div id="ex9-output" class="output"></div>
    </div>

    <script>
      // 1. CALLBACK FUNCTION using setTimeout (3 seconds)
      function exercise1() {
        const output = document.getElementById("ex1-output");
        output.innerHTML = "‚è≥ Waiting 3 seconds...";

        // Callback-based setTimeout
        setTimeout(() => {
          output.innerHTML =
            '<span class="success">‚úÖ Callback executed!</span><br>Time: ' +
            new Date().toLocaleTimeString();
        }, 3000);
      }

      // 2. CALLBACK ‚Üí PROMISE CONVERSION
      function callbackToPromise(callbackStyleFn) {
        return new Promise((resolve, reject) => {
          callbackStyleFn((result) => resolve(result));
        });
      }

      function exercise2() {
        const output = document.getElementById("ex2-output");

        // Original callback style
        const callbackFn = (cb) => {
          setTimeout(() => cb("Callback converted to Promise!"), 1000);
        };

        // Now use as Promise
        callbackToPromise(callbackFn).then((result) => {
          output.innerHTML = '<span class="success">‚úÖ ' + result + "</span>";
        });
      }

      // 3. PROMISE that resolves after 2 seconds
      function createDelayedPromise() {
        return new Promise((resolve) => {
          setTimeout(() => {
            resolve(`Promise resolved at ${new Date().toLocaleTimeString()}`);
          }, 2000);
        });
      }

      function exercise3() {
        const output = document.getElementById("ex3-output");
        output.innerHTML = "‚è≥ Promise pending (2s)...";

        createDelayedPromise().then((message) => {
          output.innerHTML = '<span class="success">‚úÖ ' + message + "</span>";
        });
      }

      // 4. REJECTED PROMISE with .catch()
      function exercise4() {
        const output = document.getElementById("ex4-output");

        Promise.reject("‚ùå Manual rejection!")
          .then(() => (output.innerHTML = "This never runs"))
          .catch((error) => {
            output.innerHTML = '<span class="error">' + error + "</span>";
          });
      }

      // 5. PROMISE ‚Üí ASYNC/AWAIT rewrite
      async function asyncVersion() {
        const output = document.getElementById("ex5-output");
        output.innerHTML = "‚è≥ Async version running...";

        const result = await createDelayedPromise();
        output.innerHTML = '<span class="success">‚úÖ ' + result + "</span>";
      }

      function exercise5() {
        asyncVersion();
      }

      // 6. TRY/CATCH with async/await
      async function riskyOperation() {
        throw new Error("Intentional async error!");
      }

      async function exercise6() {
        const output = document.getElementById("ex6-output");

        try {
          await riskyOperation();
        } catch (error) {
          output.innerHTML =
            '<span class="error">‚úÖ Caught: ' + error.message + "</span>";
        }
      }

      // 7. RANDOM SUCCESS/FAILURE PROMISE (50%)
      function randomPromise() {
        return new Promise((resolve, reject) => {
          setTimeout(() => {
            if (Math.random() > 0.5) {
              resolve("üéâ Random success!");
            } else {
              reject("üí• Random failure!");
            }
          }, 1500);
        });
      }

      function exercise7() {
        const output = document.getElementById("ex7-output");
        output.innerHTML = "üé≤ Rolling dice... (1.5s)";

        randomPromise()
          .then(
            (result) =>
              (output.innerHTML = '<span class="success">' + result + "</span>")
          )
          .catch(
            (error) =>
              (output.innerHTML = '<span class="error">' + error + "</span>")
          );
      }

      // 8. CHAIN TWO .then() methods
      function step1() {
        return new Promise((resolve) =>
          setTimeout(() => resolve("Step 1 complete"), 800)
        );
      }

      function step2(data) {
        return new Promise((resolve) =>
          setTimeout(() => resolve(data + " ‚Üí Step 2 complete"), 800)
        );
      }

      function exercise8() {
        const output = document.getElementById("ex8-output");

        step1()
          .then((result1) => {
            output.innerHTML = "Step 1: " + result1;
            return step2(result1);
          })
          .then((result2) => {
            output.innerHTML +=
              '<br>Step 2: <span class="success">' + result2 + "</span>";
          });
      }

      // 9. ASYNC FUNCTION waiting for TWO PROMISES (Promise.all)
      async function exercise9() {
        const output = document.getElementById("ex9-output");
        output.innerHTML = "‚è≥ Waiting for both promises...";

        const [userData, postsData] = await Promise.all([
          new Promise((resolve) =>
            setTimeout(() => resolve({ name: "Jawahar", id: 1 }), 1200)
          ),
          new Promise((resolve) =>
            setTimeout(() => resolve(["Post 1", "Post 2"]), 1800)
          ),
        ]);

        output.innerHTML = `
         User: ${userData.name}<br>
         Posts: ${postsData.length}<br>
        Time: ${new Date().toLocaleTimeString()}
      `;
      }

      // 10. Async function output explanation
      /*
    async function explainOutput() {
      console.log('1. Function starts');          
      const result = await new Promise(r => setTimeout(r, 1000));  
      console.log('2. Await complete:', result);  
      return 'Final result';                       
    }
    
    explainOutput().then(console.log);            
    
    OUTPUT ORDER:
    1. "Function starts"          (immediate)
    2. (1 second pause)
    3. "2. Await complete: ..."   (after delay)
    4. "Final result"             (.then() callback)
    */
    </script>
  </body>
</html>
